<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #222; color: white; margin: 0; padding: 0; }
        
        /* Player fixo no topo */
        #player-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            background: black; 
            padding: 10px 0;
            z-index: 1000; 
        }
        
        video { width: 100%; max-height: 300px; }

        /* Lista de canais ajustada para rolar sem mover o player */
        #channels-container { 
            margin-top: 320px; /* Deixar espaço para o player fixo */
            padding: 10px;
            overflow-y: auto;
        }

        #channels { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
        }

        .channel { 
            cursor: pointer; 
            padding: 10px; 
            border: 1px solid white; 
            margin: 5px; 
            text-align: center;
            width: 120px;
            background: #333; 
            border-radius: 5px;
        }

        .channel img { 
            width: 80px; 
            height: 80px; 
            display: block;
            margin: 0 auto 5px;
        }
    </style>
</head>
<body>
    <div id="player-container">
        <video id="player" controls autoplay></video>
    </div>

    <div id="channels-container">
        <h2>Lista de Canais</h2>
        <div id="channels"></div>
    </div>

    <script>
        let server = "http://ct5play.lat";
        let username = "Dyeimes";
        let password = "13579111315aa";
        let proxyUrl = "https://corsproxy.io/?";

        async function loadChannels() {
            let apiUrl = `${server}/player_api.php?username=${username}&password=${password}&action=get_live_streams`;
            try {
                let response = await fetch(proxyUrl + apiUrl);
                let data = await response.json();

                if (data.length === 0) {
                    document.getElementById("channels").innerHTML = "<p>Nenhum canal encontrado.</p>";
                    return;
                }

                let channelsHtml = "";
                data.forEach(channel => {
                    channelsHtml += `<div class="channel" onclick="playChannel(${channel.stream_id})">
                        <img src="${channel.stream_icon || 'https://via.placeholder.com/50'}">
                        <p>${channel.name}</p>
                    </div>`;
                });

                document.getElementById("channels").innerHTML = channelsHtml;
            } catch (error) {
                document.getElementById("channels").innerHTML = "<p>Erro ao carregar canais.</p>";
            }
        }

        function playChannel(stream_id) {
            let video = document.getElementById("player");
            let channelUrl = `${server}/live/${username}/${password}/${stream_id}.m3u8`;

            // Remover buffer atrasado para carregar mais rápido
            if (Hls.isSupported()) {
                if (window.hls) {
                    window.hls.destroy();
                }
                window.hls = new Hls({ 
                    maxBufferLength: 5,  // Reduzir o buffer para começar a rodar rápido
                    liveSyncDurationCount: 3,
                    xhrSetup: function (xhr) {
                        xhr.setRequestHeader("User-Agent", "VLC/3.0.18 LibVLC/3.0.18");
                    }
                });
                window.hls.loadSource(channelUrl);
                window.hls.attachMedia(video);
            } else {
                video.src = proxyUrl + channelUrl;
            }
        }

        loadChannels();
    </script>
</body>
</html>