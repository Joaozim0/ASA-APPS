<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #222; color: white; }
        #player-container { width: 100%; max-width: 600px; margin: auto; }
        video { width: 100%; max-height: 300px; background: black; }
        #channels { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
        .channel { cursor: pointer; padding: 5px; border: 1px solid white; margin: 5px; }
    </style>
</head>
<body>
    <h1>IPTV Player</h1>
    <div id="player-container">
        <video id="player" controls autoplay></video>
    </div>
    <div id="channels"></div>

    <script>
        let server = "http://ct5play.lat";
        let username = "Dyeimes";
        let password = "13579111315aa";
        let proxyUrl = "https://corsproxy.io/?";

        async function loadChannels() {
            let apiUrl = `${server}/player_api.php?username=${username}&password=${password}&action=get_live_streams`;
            try {
                let response = await fetch(proxyUrl + apiUrl);
                let data = await response.json();

                if (data.length === 0) {
                    document.getElementById("channels").innerHTML = "<p>Nenhum canal encontrado.</p>";
                    return;
                }

                let channelsHtml = "";
                data.forEach(channel => {
                    channelsHtml += `<div class="channel" onclick="playChannel(${channel.stream_id})">
                        <img src="${channel.stream_icon || 'https://via.placeholder.com/50'}" width="50" height="50">
                        <p>${channel.name}</p>
                    </div>`;
                });

                document.getElementById("channels").innerHTML = channelsHtml;
            } catch (error) {
                document.getElementById("channels").innerHTML = "<p>Erro ao carregar canais.</p>";
            }
        }

        function playChannel(stream_id) {
            let video = document.getElementById("player");
            let channelUrl = `${server}/live/${username}/${password}/${stream_id}.m3u8`;

            if (Hls.isSupported()) {
                let hls = new Hls({ 
                    xhrSetup: function (xhr) {
                        xhr.setRequestHeader("User-Agent", "VLC/3.0.18 LibVLC/3.0.18");
                    }
                });
                hls.loadSource(proxyUrl + channelUrl);
                hls.attachMedia(video);
            } else {
                video.src = proxyUrl + channelUrl;
            }
        }

        loadChannels();
    </script>
</body>
</html>